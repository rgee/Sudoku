<!DOCTYPE html>  <html> <head>   <title>sudoku.solver.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="sudoku.action.html">                 sudoku.action.js               </a>                                           <a class="source" href="sudoku.board.html">                 sudoku.board.js               </a>                                           <a class="source" href="sudoku.core.html">                 sudoku.core.js               </a>                                           <a class="source" href="sudoku.solver.html">                 sudoku.solver.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               sudoku.solver.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
	<span class="kd">function</span> <span class="nx">Solver</span><span class="p">(</span><span class="nx">board</span><span class="p">){</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Array of 2d, row-major arrays representing the 3x3 subSquares on the board.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">this</span><span class="p">.</span><span class="nx">subSquares</span> <span class="o">=</span> <span class="p">[];</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">proc</span> <span class="o">=</span> <span class="nx">board</span><span class="p">.</span><span class="nx">proc</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Board object</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">this</span><span class="p">.</span><span class="nx">board</span> <span class="o">=</span> <span class="nx">board</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>3d Array repreenting the internal representation of the board, which is an array of potential values an unfilled square could
take for each unfilled square.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">this</span><span class="p">.</span><span class="nx">internalRepr</span> <span class="o">=</span> <span class="p">[];</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Cached copy of the internal representation from the previous iteration.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">this</span><span class="p">.</span><span class="nx">lastInternalRepr</span> <span class="o">=</span> <span class="p">[];</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Set of values from 1-9. Useful in various places.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">this</span><span class="p">.</span><span class="nx">allSet</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HashSet</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">u</span><span class="p">){</span> <span class="k">return</span> <span class="nx">u</span><span class="p">;},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">u</span><span class="p">,</span> <span class="nx">v</span><span class="p">){</span><span class="k">return</span> <span class="nx">u</span> <span class="o">===</span> <span class="nx">v</span><span class="p">;});</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">allSet</span><span class="p">.</span><span class="nx">addAll</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">]);</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Array of values from 1-9. Used to limit searchess to specific values.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">this</span><span class="p">.</span><span class="nx">all</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">allSet</span><span class="p">.</span><span class="nx">values</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>The index into the all array for the current value we're using for searches.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">this</span><span class="p">.</span><span class="nx">currentValueIdx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Flag to indicate the victory message has been displayed once.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">this</span><span class="p">.</span><span class="nx">solvedMessageDisplayed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Flag to indicate if the grid has been changed this iteration.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">this</span><span class="p">.</span><span class="nx">changedThisIteration</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Counter for how many consecutive times the board has not been modified.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">this</span><span class="p">.</span><span class="nx">noChangeCounter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>The maximum allowable number of consecutive times the solver can not modify the grid before giving up.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">this</span><span class="p">.</span><span class="nx">noChangeCutoff</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Is the solver solving or not?</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">this</span><span class="p">.</span><span class="nx">active</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Chance certian calculations will succeed</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">this</span><span class="p">.</span><span class="nx">accuracy</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>A bare minimum for accuracy. I'm not that terrible!</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">this</span><span class="p">.</span><span class="nx">baseAccuracy</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Stack of the last actions, the number of which determined by maxHistoryLength</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">this</span><span class="p">.</span><span class="nx">actionHistory</span> <span class="o">=</span> <span class="p">[];</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Number of moves to remember</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">this</span><span class="p">.</span><span class="nx">maxHistoryLength</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Current number of actions taken on the grid</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">this</span><span class="p">.</span><span class="nx">actionCounter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	</pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Number of backtrack attempts        </p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">this</span><span class="p">.</span><span class="nx">backtrackCounter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Actions at which we began backtracking.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">this</span><span class="p">.</span><span class="nx">errorActionCounter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Number of backtracks before we give up trying to correct mistakes.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">this</span><span class="p">.</span><span class="nx">frustrationWall</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Set up the internal representation.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">board</span><span class="p">.</span><span class="nx">ready</span><span class="p">){</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">processSubSquares</span><span class="p">();</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">calculatePotentials</span><span class="p">();</span>
		<span class="p">}</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">adjustAccuracy</span><span class="p">();</span>

	<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Add a convenience function to the array prototype to compare them.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">compareArrays</span><span class="p">)</span> <span class="p">{</span>
		<span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">compareArrays</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arr</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">!=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
		    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">compareArrays</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//likely nested array</span>
		            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">compareArrays</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
		            <span class="k">else</span> <span class="k">continue</span><span class="p">;</span>
		        <span class="p">}</span>
		        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">!=</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
		    <span class="p">}</span>
		    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
		<span class="p">};</span>
	<span class="p">}</span>

	<span class="nx">Solver</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Run through all knowledge-refinement and square-filling tactics once.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">solve</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
			<span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">active</span><span class="p">){</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">changedThisIteration</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Make sure our internal representations are up-to-date.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">this</span><span class="p">.</span><span class="nx">processSubSquares</span><span class="p">();</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">calculatePotentials</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Apply strategies</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">this</span><span class="p">.</span><span class="nx">allButOne</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">all</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">currentValueIdx</span><span class="p">]);</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">eliminatePairs</span><span class="p">();</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">eliminateTriples</span><span class="p">();</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">takeOpportunities</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">all</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">currentValueIdx</span><span class="p">]);</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>If we made changes to the grid</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">changedThisIteration</span><span class="p">){</span>
					<span class="k">this</span><span class="p">.</span><span class="nx">noChangeCounter</span><span class="o">++</span><span class="p">;</span>
				<span class="p">}</span><span class="k">else</span><span class="p">{</span>
					<span class="k">this</span><span class="p">.</span><span class="nx">noChangeCounter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Have we gone too many iterations without changing the grid?</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">noChangeCounter</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">noChangeCutoff</span><span class="p">){</span>
					<span class="k">this</span><span class="p">.</span><span class="nx">errorActionCounter</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">actionCounter</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Do we still have the willpower to try again?</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">backtrackCounter</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">frustrationWall</span><span class="p">){</span>
						<span class="k">this</span><span class="p">.</span><span class="nx">rollBackActions</span><span class="p">();</span>
						<span class="k">this</span><span class="p">.</span><span class="nx">backtrackCounter</span><span class="o">++</span><span class="p">;</span>
					<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">actionCounter</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">errorActionCounter</span><span class="p">){</span>
						<span class="k">this</span><span class="p">.</span><span class="nx">backtrackCounter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
						<span class="k">this</span><span class="p">.</span><span class="nx">noChangeCounter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
					<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">backtrackCounter</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">maxHistoryLength</span><span class="p">){</span>
						<span class="k">this</span><span class="p">.</span><span class="nx">active</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
						<span class="nx">Sudoku</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Tried to correct mistakes, but failed.&quot;</span><span class="p">);</span>
					<span class="p">}</span><span class="k">else</span> <span class="p">{</span>
						<span class="k">this</span><span class="p">.</span><span class="nx">active</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
						<span class="nx">Sudoku</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Went too long without modifying the grid. Stuck.&#39;</span><span class="p">);</span>
					<span class="p">}</span>
				<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>We're done!</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">solved</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">solvedMessageDisplayed</span><span class="p">){</span>
					<span class="nx">Sudoku</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Puzzle solved.&#39;</span><span class="p">);</span>
					<span class="k">this</span><span class="p">.</span><span class="nx">solvedMessageDisplayed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
					<span class="k">this</span><span class="p">.</span><span class="nx">active</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
				<span class="p">}</span>

				<span class="k">this</span><span class="p">.</span><span class="nx">currentValueIdx</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentValueIdx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">9</span><span class="p">;</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">adjustAccuracy</span><span class="p">();</span>
			<span class="p">}</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Stores an action in the solver's memory bank</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">logAction</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">action</span><span class="p">){</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">actionCounter</span><span class="o">++</span><span class="p">;</span>
			<span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">actionHistory</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">maxHistoryLength</span><span class="p">){</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">actionHistory</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">actionHistory</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">action</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">actionHistory</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">action</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Undo every action in the action history. Used to try and correct mistakes.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">rollBackActions</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
			<span class="nx">Sudoku</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Backtracking...&quot;</span><span class="p">)</span>
			<span class="kd">var</span> <span class="nx">lastAction</span><span class="p">,</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">while</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">actionHistory</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">actionCounter</span><span class="o">--</span><span class="p">;</span>
				<span class="nx">lastAction</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">actionHistory</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
				<span class="k">switch</span><span class="p">(</span><span class="nx">lastAction</span><span class="p">.</span><span class="nx">type</span><span class="p">){</span>
					<span class="k">case</span> <span class="s2">&quot;INVALID&quot;</span><span class="o">:</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>There's been some erroneous action added. Terminate</p>             </td>             <td class="code">               <div class="highlight"><pre>						<span class="k">this</span><span class="p">.</span><span class="nx">active</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
						<span class="nx">Sudoku</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Invalid action added to history. Cannot revert.&quot;</span><span class="p">);</span>
						<span class="k">return</span><span class="p">;</span>
						<span class="k">break</span><span class="p">;</span>
					<span class="k">case</span> <span class="s2">&quot;SQUARE_FILLED&quot;</span><span class="o">:</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Remove the value from the square specified</p>             </td>             <td class="code">               <div class="highlight"><pre>						<span class="k">this</span><span class="p">.</span><span class="nx">board</span><span class="p">.</span><span class="nx">fillSquare</span><span class="p">(</span><span class="nx">lastAction</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">row</span><span class="p">,</span> <span class="nx">lastAction</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">col</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
						<span class="k">break</span><span class="p">;</span>
					<span class="k">default</span><span class="o">:</span>
						<span class="k">break</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">},</span>
		<span class="nx">adjustAccuracy</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>	
			<span class="k">this</span><span class="p">.</span><span class="nx">accuracy</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">baseAccuracy</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">board</span><span class="p">.</span><span class="nx">numFilled</span> <span class="o">/</span> <span class="mi">81</span><span class="p">);</span>

		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Checks the knowledge base for a possibility list.
This function does not always return a correct result. It has a 
chance, based on the solver's accuracy to either return the correct result,
return the result with an extra (valid) number added, or return the result
with a random number removed.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">checkKnowledge</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span> <span class="nx">col</span><span class="p">){</span>
			<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">madeMistake</span><span class="p">()){</span>
				<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">internalRepr</span><span class="p">[</span><span class="nx">row</span><span class="p">][</span><span class="nx">col</span><span class="p">];</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">internalRepr</span><span class="p">[</span><span class="nx">row</span><span class="p">][</span><span class="nx">col</span><span class="p">];</span>
					<span class="nx">res</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nx">res</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
				<span class="k">if</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">){</span>
					<span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
				<span class="p">}</span><span class="k">else</span><span class="p">{</span>
					<span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">res</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>Returns true if the current configuration is solved. False otherwise.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">solved</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
			<span class="k">return</span>  <span class="k">this</span><span class="p">.</span><span class="nx">rowsValid</span><span class="p">()</span> <span class="o">&amp;&amp;</span>
					<span class="k">this</span><span class="p">.</span><span class="nx">columnsValid</span><span class="p">()</span> 
					<span class="k">this</span><span class="p">.</span><span class="nx">subSquaresValid</span><span class="p">();</span>	

		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Returns true if an array of numbers is a permutation of 1 to 9.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">isPermutation</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">numbers</span><span class="p">){</span>
			<span class="k">if</span><span class="p">(</span><span class="nx">numbers</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">9</span><span class="p">){</span>
				<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
			<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Use a set to detect duplicates</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="kd">var</span> <span class="nx">seen</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HashSet</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">u</span><span class="p">){</span> <span class="k">return</span> <span class="nx">u</span><span class="p">;},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">u</span><span class="p">,</span> <span class="nx">v</span><span class="p">){</span><span class="k">return</span> <span class="nx">u</span> <span class="o">===</span> <span class="nx">v</span><span class="p">;}),</span>
				<span class="nx">allPresent</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
				<span class="nx">noDuplicates</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Check if there are any duplicate numbers</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">numbers</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">seen</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">e</span><span class="p">)){</span>
					<span class="nx">noDuplicates</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="nx">seen</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Check if every number in 1...9 is present.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">allPresent</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">allSet</span><span class="p">.</span><span class="nx">values</span><span class="p">().</span><span class="nx">every</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
				<span class="k">return</span> <span class="nx">seen</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
			<span class="p">});</span>

			<span class="k">return</span> <span class="p">(</span><span class="nx">allPresent</span> <span class="o">&amp;&amp;</span> <span class="nx">noDuplicates</span><span class="p">);</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Returns true if all the rows in the board are a permutation of 1 to 9.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">rowsValid</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
			<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">board</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">every</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">row</span><span class="p">){</span>
				<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">isPermutation</span><span class="p">(</span><span class="nx">row</span><span class="p">);</span>
			<span class="p">},</span><span class="k">this</span><span class="p">);</span>			
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>Returns true if all the columns in the board are a permutation of 1 to 9.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">columnsValid</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>Takes a 2d array and returns a transposed representation of it.
Declare the fn in a closure so it isn't created on every invocation.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="kd">var</span> <span class="nx">transpose</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arr</span><span class="p">){</span>
				<span class="kd">var</span> <span class="nx">temp</span><span class="p">,</span>
					<span class="nx">result</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
				<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
					<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">){</span>
						<span class="nx">temp</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">];</span>
						<span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">j</span><span class="p">][</span><span class="nx">i</span><span class="p">];</span>
						<span class="nx">arr</span><span class="p">[</span><span class="nx">j</span><span class="p">][</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">temp</span><span class="p">;</span>
					<span class="p">}</span>
				<span class="p">}</span>
				<span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
			<span class="p">};</span>
			<span class="k">return</span> <span class="kd">function</span><span class="p">(){</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Rotate the array 90 degrees, then check if the rows are then valid.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">rowsValid</span><span class="p">(</span><span class="nx">transpose</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">board</span><span class="p">.</span><span class="nx">data</span><span class="p">));</span>
			<span class="p">}.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
			
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>Returns true if all the 3x3 subSquares are a permutation of 1 to 9.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">subSquaresValid</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
			<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">subSquares</span><span class="p">.</span><span class="nx">every</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ss</span><span class="p">){</span>
				<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">isPermutation</span><span class="p">(</span><span class="nx">ss</span><span class="p">);</span>
			<span class="p">},</span><span class="k">this</span><span class="p">);</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>Divides the grid into the 3x3 units for constraint testing and stores them in
a linear array in row-major order. Each element of subSquares itself is a 2d
array representing the subSquare in row-major order.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">processSubSquares</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">subSquares</span> <span class="o">=</span> <span class="p">[];</span>
			<span class="kd">var</span> <span class="nx">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">col</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">;</span> <span class="nx">col</span><span class="o">+=</span><span class="mi">3</span><span class="p">){</span>
				<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">row</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">;</span> <span class="nx">row</span><span class="o">+=</span><span class="mi">3</span><span class="p">){</span>
					<span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">();</span>
					<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="o">++</span><span class="nx">x</span><span class="p">){</span>
						<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="o">++</span><span class="nx">y</span><span class="p">){</span>
							<span class="nx">data</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">board</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">col</span> <span class="o">+</span> <span class="nx">x</span><span class="p">][</span><span class="nx">row</span> <span class="o">+</span> <span class="nx">y</span><span class="p">]);</span>
						<span class="p">}</span>
					<span class="p">}</span>
					<span class="k">this</span><span class="p">.</span><span class="nx">subSquares</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
				<span class="p">}</span>
				
			<span class="p">}</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Fill in a square on the grid and update internal representations </p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">fillSquare</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span> <span class="nx">col</span><span class="p">,</span> <span class="nx">val</span><span class="p">){</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">board</span><span class="p">.</span><span class="nx">fillSquare</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span> <span class="nx">col</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">processSubSquares</span><span class="p">();</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">calculatePotentials</span><span class="p">();</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Fill a square on the grid if it only has one potential value.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">takeOpportunities</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">){</span>
			<span class="nx">Sudoku</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;*TakeOpportunities*&#39;</span><span class="p">);</span>
			<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">col</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">;</span> <span class="nx">col</span><span class="o">++</span><span class="p">){</span>
				<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">row</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">;</span> <span class="nx">row</span><span class="o">++</span><span class="p">){</span>
					<span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">checkKnowledge</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span> <span class="nx">col</span><span class="p">).</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">internalRepr</span><span class="p">[</span><span class="nx">row</span><span class="p">][</span><span class="nx">col</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="nx">value</span><span class="p">){</span>
						<span class="k">this</span><span class="p">.</span><span class="nx">fillSquare</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span><span class="nx">col</span><span class="p">,</span><span class="nx">value</span><span class="p">);</span>
						<span class="k">this</span><span class="p">.</span><span class="nx">changedThisIteration</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
						<span class="k">this</span><span class="p">.</span><span class="nx">logAction</span><span class="p">(</span><span class="k">new</span> <span class="nx">Sudoku</span><span class="p">.</span><span class="nx">Action</span><span class="p">(</span><span class="s2">&quot;SQUARE_FILLED&quot;</span><span class="p">,</span><span class="k">new</span> <span class="nx">Sudoku</span><span class="p">.</span><span class="nx">SquareFillData</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span> <span class="nx">col</span><span class="p">,</span> <span class="nx">value</span><span class="p">)));</span>
						<span class="nx">Sudoku</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Added &#39;</span> <span class="o">+</span> <span class="nx">value</span> <span class="o">+</span> <span class="s1">&#39; to the board at (&#39;</span><span class="o">+</span><span class="nx">col</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">+</span><span class="nx">row</span><span class="o">+</span><span class="s1">&#39;) by TakeOpportunities.&#39;</span><span class="p">);</span>
					<span class="p">}</span>	
				<span class="p">}</span>

			<span class="p">}</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Helper function to do row-major math on the subSquare grid </p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">subSquareIdx</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span><span class="nx">col</span><span class="p">){</span>
			<span class="k">return</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">row</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">col</span><span class="o">/</span><span class="mi">3</span><span class="p">));</span>
		<span class="p">},</span>
		<span class="nx">inverseSubSquareIdx</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ssIdx</span><span class="p">){</span>
			<span class="kd">var</span> <span class="nx">row</span> <span class="o">=</span> <span class="nx">ssIdx</span> <span class="o">%</span> <span class="mi">9</span><span class="p">,</span>
				<span class="nx">col</span> <span class="o">=</span> <span class="nx">ssIdx</span> <span class="o">-</span> <span class="p">(</span><span class="nx">row</span> <span class="o">*</span> <span class="mi">9</span><span class="p">);</span>
			<span class="k">return</span> <span class="p">[</span><span class="nx">row</span><span class="p">,</span> <span class="nx">col</span><span class="p">];</span>	
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>Calculate the potential numbers for each grid square, thus creating the solver's internal
representation of the sudoku board. Creates a 3d array of potential numbers from 1-9. </p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">calculatePotentials</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
			<span class="kd">var</span> <span class="nx">all</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">];</span>

			<span class="k">this</span><span class="p">.</span><span class="nx">internalRepr</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">9</span><span class="p">);</span>
			<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">row</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">;</span> <span class="nx">row</span><span class="o">++</span><span class="p">){</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">internalRepr</span><span class="p">[</span><span class="nx">row</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">9</span><span class="p">);</span>
				<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">col</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">;</span> <span class="nx">col</span><span class="o">++</span><span class="p">){</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>Calculate possible numbers based on row/col/subsquare constraints if not given.</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">board</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">row</span><span class="p">][</span><span class="nx">col</span><span class="p">]){</span>
						 <span class="kd">var</span> <span class="nx">subSquareIdx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">subSquareIdx</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span><span class="nx">col</span><span class="p">);</span>
						 <span class="kd">var</span> <span class="nx">possibilities</span> <span class="o">=</span> <span class="nx">all</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
						 <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">all</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
						 	<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
					 		<span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">board</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">row</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">all</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">){</span>
					 			<span class="nx">result</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
					 		<span class="p">}</span>
					 		<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">){</span>
					 			<span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">board</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">j</span><span class="p">][</span><span class="nx">col</span><span class="p">]</span> <span class="o">===</span> <span class="nx">all</span><span class="p">[</span><span class="nx">i</span><span class="p">]){</span>
					 				<span class="nx">result</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
					 				<span class="k">break</span><span class="p">;</span>
					 			<span class="p">}</span>
					 		<span class="p">}</span>

					 		<span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">subSquares</span><span class="p">[</span><span class="nx">subSquareIdx</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">all</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">){</span>
					 			<span class="nx">result</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
					 		<span class="p">}</span>
					 		<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">result</span><span class="p">){</span>
					 			<span class="nx">possibilities</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">possibilities</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">all</span><span class="p">[</span><span class="nx">i</span><span class="p">]),</span><span class="mi">1</span><span class="p">);</span>
					 		<span class="p">}</span>
						 <span class="p">}</span>
						 <span class="k">this</span><span class="p">.</span><span class="nx">internalRepr</span><span class="p">[</span><span class="nx">row</span><span class="p">][</span><span class="nx">col</span><span class="p">]</span> <span class="o">=</span> <span class="nx">possibilities</span><span class="p">;</span>
					<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
						<span class="k">this</span><span class="p">.</span><span class="nx">internalRepr</span><span class="p">[</span><span class="nx">row</span><span class="p">][</span><span class="nx">col</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
					<span class="p">}</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>Check to see if the solver has just made a mistake. Returns true if it has, false otherwise.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">madeMistake</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
			<span class="kd">var</span> <span class="nx">rand</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">();</span>
			<span class="k">if</span><span class="p">(</span><span class="nx">rand</span> <span class="o">&lt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">accuracy</span><span class="p">){</span>
				<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>	
			<span class="p">}</span><span class="k">else</span><span class="p">{</span>
				<span class="nx">Sudoku</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;The solver made a mistake!! (&#39;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">accuracy</span><span class="o">+</span><span class="s1">&#39;) &#39;</span> <span class="o">+</span> <span class="nx">rand</span><span class="p">);</span>
				<span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>Taking each group of three columns or rows (non-overlapping), if a number appears in two of the three subsquares
the group covers, then we know what row or column that number must appear within the final subsquare that does
not have it. Using that, we see if the row or column, within the subgroup without that number only has one square
left unfilled. If so, fill it with that number because we know it could go nowhere else.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">allButOne</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">){</span>
			<span class="nx">Sudoku</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;AllButOne&#39;</span><span class="p">)</span>
			<span class="kd">var</span> <span class="nx">possibleSubSquares</span><span class="p">,</span>
				<span class="nx">actualSubSquares</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>Performs the allButOne check on rows.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">rowsStart</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">rowsEnd</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="nx">rowsEnd</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">;</span> <span class="nx">rowsEnd</span> <span class="o">+=</span> <span class="mi">3</span><span class="p">,</span> <span class="nx">rowsStart</span> <span class="o">+=</span><span class="mi">3</span><span class="p">){</span>
				<span class="kd">var</span> <span class="nx">rowGroup</span> <span class="o">=</span> <span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">board</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">rowsStart</span><span class="p">],</span>
						        <span class="k">this</span><span class="p">.</span><span class="nx">board</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">rowsStart</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
						        <span class="k">this</span><span class="p">.</span><span class="nx">board</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">rowsStart</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]],</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>Map the three rows to an array of pairs representing the coordinates
of the given element in the board.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">coords</span> <span class="o">=</span> <span class="nx">rowGroup</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">elem</span><span class="p">,</span> <span class="nx">index</span><span class="p">){</span>
					<span class="kd">var</span>	<span class="nx">row</span> <span class="o">=</span> <span class="nx">rowsStart</span> <span class="o">+</span> <span class="nx">index</span><span class="p">,</span>
						<span class="nx">col</span> <span class="o">=</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>

					<span class="k">return</span> <span class="p">[</span><span class="nx">row</span><span class="p">,</span> <span class="nx">col</span><span class="p">];</span>
				<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>Only continue if exactly one row did not have the given number assigned.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">if</span><span class="p">(</span><span class="nx">coords</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
					<span class="k">return</span> <span class="p">(</span><span class="nx">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
				<span class="p">}).</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>Inaccurate computation. We missed a few squares.</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">madeMistake</span><span class="p">()){</span>
						<span class="k">return</span><span class="p">;</span>
					<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>Grab the coordinate of the row without the value in it.</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="kd">var</span> <span class="nx">definiteRowCoord</span> <span class="o">=</span> <span class="nx">coords</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
						<span class="k">return</span> <span class="p">(</span><span class="nx">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
					<span class="p">}).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
						<span class="k">return</span> <span class="nx">e</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
					<span class="p">})[</span><span class="mi">0</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>Narrow down which subSquare does not have the value.</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="nx">possibleSubSquares</span> <span class="o">=</span> <span class="p">[</span><span class="nx">rowsStart</span><span class="p">,</span> <span class="nx">rowsStart</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">rowsStart</span> <span class="o">+</span> <span class="mi">2</span><span class="p">],</span>
					<span class="nx">actualSubSquares</span> <span class="o">=</span> <span class="nx">coords</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
						<span class="k">return</span> <span class="nx">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
					<span class="p">}).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
						<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">subSquareIdx</span><span class="p">(</span><span class="nx">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
					<span class="p">},</span> <span class="k">this</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>Filter out everything but the subSquare without the number assigned.</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="nx">actualSubSquares</span> <span class="o">=</span> <span class="nx">possibleSubSquares</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
						<span class="k">return</span> <span class="nx">actualSubSquares</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
					<span class="p">})[</span><span class="mi">0</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>Extract the segment of the row the value could be placed into.</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="kd">var</span> <span class="nx">rowSegment</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">board</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">definiteRowCoord</span><span class="p">].</span><span class="nx">slice</span><span class="p">(</span><span class="nx">actualSubSquares</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="nx">actualSubSquares</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">3</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>If there's only one empty slot, the value must be placed there.</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="k">if</span><span class="p">(</span><span class="nx">rowSegment</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
						<span class="k">return</span> <span class="nx">e</span> <span class="o">===</span> <span class="mi">0</span><span class="p">;</span>
					<span class="p">}).</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">){</span>
						<span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">madeMistake</span><span class="p">()){</span>
							<span class="k">return</span><span class="p">;</span>
						<span class="p">}</span>
						<span class="kd">var</span> <span class="nx">definiteColCoord</span> <span class="o">=</span> <span class="p">(</span><span class="nx">actualSubSquares</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="nx">rowSegment</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
						<span class="k">this</span><span class="p">.</span><span class="nx">fillSquare</span><span class="p">(</span><span class="nx">definiteRowCoord</span><span class="p">,</span> <span class="nx">definiteColCoord</span><span class="p">,</span><span class="nx">value</span><span class="p">);</span>
						<span class="k">this</span><span class="p">.</span><span class="nx">changedThisIteration</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
						<span class="nx">Sudoku</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Added &#39;</span> <span class="o">+</span> <span class="nx">value</span> <span class="o">+</span> <span class="s1">&#39; to the board at (&#39;</span><span class="o">+</span><span class="nx">definiteColCoord</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">+</span><span class="nx">definiteRowCoord</span><span class="o">+</span><span class="s1">&#39;) using AllButOne.&#39;</span><span class="p">);</span>
					<span class="p">}</span>
				<span class="p">}</span>
			<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>Perform the all but one check on groups of columns...eugh.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">colsStart</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">colsEnd</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="nx">colsEnd</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">;</span> <span class="nx">colsEnd</span> <span class="o">+=</span> <span class="mi">3</span><span class="p">,</span> <span class="nx">colsStart</span> <span class="o">+=</span> <span class="mi">3</span><span class="p">){</span>
				<span class="kd">var</span> <span class="nx">colGroup</span> <span class="o">=</span> <span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">board</span><span class="p">.</span><span class="nx">getColumn</span><span class="p">(</span><span class="nx">colsStart</span><span class="p">),</span>
					            <span class="k">this</span><span class="p">.</span><span class="nx">board</span><span class="p">.</span><span class="nx">getColumn</span><span class="p">(</span><span class="nx">colsStart</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
					            <span class="k">this</span><span class="p">.</span><span class="nx">board</span><span class="p">.</span><span class="nx">getColumn</span><span class="p">(</span><span class="nx">colsStart</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)];</span>
				<span class="nx">coords</span> <span class="o">=</span> <span class="nx">colGroup</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">elem</span><span class="p">,</span> <span class="nx">index</span><span class="p">){</span>
					<span class="kd">var</span> <span class="nx">row</span> <span class="o">=</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">value</span><span class="p">),</span>
						<span class="nx">col</span> <span class="o">=</span> <span class="nx">colsStart</span> <span class="o">+</span> <span class="nx">index</span><span class="p">;</span>
					<span class="k">return</span> <span class="p">[</span><span class="nx">row</span><span class="p">,</span> <span class="nx">col</span><span class="p">];</span>
				<span class="p">});</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">coords</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
					<span class="k">return</span> <span class="p">(</span><span class="nx">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
				<span class="p">}).</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">){</span>
					<span class="kd">var</span> <span class="nx">definiteColCoord</span> <span class="o">=</span> <span class="nx">coords</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
						<span class="k">return</span> <span class="p">(</span><span class="nx">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
					<span class="p">}).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
						<span class="k">return</span> <span class="nx">e</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
					<span class="p">})[</span><span class="mi">0</span><span class="p">];</span>

					<span class="nx">possibleSubSquares</span> <span class="o">=</span> <span class="p">[</span><span class="nx">colsStart</span><span class="p">,</span> <span class="nx">colsStart</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">colsStart</span> <span class="o">+</span><span class="mi">2</span><span class="p">].</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="nx">e</span><span class="o">*</span><span class="mi">3</span><span class="p">;}),</span>
					<span class="nx">actualSubSquares</span> <span class="o">=</span> <span class="nx">coords</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
							<span class="k">return</span> <span class="nx">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
						<span class="p">}).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
							<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">subSquareIdx</span><span class="p">(</span><span class="nx">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
						<span class="p">},</span> <span class="k">this</span><span class="p">);</span>

					<span class="nx">actualSubSquares</span> <span class="o">=</span> <span class="nx">possibleSubSquares</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
						<span class="k">return</span> <span class="nx">actualSubSquares</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
					<span class="p">})[</span><span class="mi">0</span><span class="p">];</span>

					<span class="kd">var</span> <span class="nx">colSegment</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">board</span><span class="p">.</span><span class="nx">getColumn</span><span class="p">(</span><span class="nx">definiteColCoord</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="nx">actualSubSquares</span><span class="p">,</span> <span class="nx">actualSubSquares</span> <span class="o">+</span> <span class="mi">3</span><span class="p">);</span>

					<span class="k">if</span><span class="p">(</span><span class="nx">colSegment</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
						<span class="k">return</span> <span class="nx">e</span> <span class="o">===</span> <span class="mi">0</span><span class="p">;</span>
					<span class="p">}).</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">){</span>
						<span class="kd">var</span> <span class="nx">definiteRowCoord</span> <span class="o">=</span> <span class="nx">actualSubSquares</span> <span class="o">+</span> <span class="nx">colSegment</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
						<span class="k">this</span><span class="p">.</span><span class="nx">fillSquare</span><span class="p">(</span><span class="nx">definiteRowCoord</span><span class="p">,</span> <span class="nx">definiteColCoord</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
						<span class="nx">Sudoku</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Added &#39;</span> <span class="o">+</span> <span class="nx">value</span> <span class="o">+</span> <span class="s1">&#39; to the board at (&#39;</span><span class="o">+</span><span class="nx">definiteColCoord</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">+</span><span class="nx">definiteRowCoord</span><span class="o">+</span><span class="s1">&#39;) using AllButOne.&#39;</span><span class="p">);</span>
					<span class="p">}</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">},</span>
		<span class="nx">eliminatePairs</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
			<span class="nx">Sudoku</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;*EliminatePairs*&#39;</span><span class="p">)</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">eliminateGroups</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>	
		<span class="p">},</span>
		<span class="nx">eliminateTriples</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
			<span class="nx">Sudoku</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;*EliminateTriples*&#39;</span><span class="p">);</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">eliminateGroups</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>	
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>If, along a row or a column, a length (either two or three) number of cells share a common, length
long possibility list, then we know the values in the possibility list MUST be placed in those two
cells, so we can remove them as possibilities from cells in that row or column.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">eliminateGroups</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">length</span><span class="p">){</span>
			<span class="kd">var</span> <span class="nx">elem</span> <span class="o">=</span> <span class="nx">temp</span> <span class="o">=</span> <span class="nx">removed</span> <span class="o">=</span> <span class="nx">numMatches</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
			<span class="nx">numMatches</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">row</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">;</span> <span class="nx">row</span><span class="o">++</span><span class="p">){</span>
				<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">col</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">;</span> <span class="nx">col</span><span class="o">++</span><span class="p">){</span>
					<span class="nx">elem</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">internalRepr</span><span class="p">[</span><span class="nx">row</span><span class="p">][</span><span class="nx">col</span><span class="p">].</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
					<span class="k">if</span><span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="nx">length</span><span class="p">){</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p><strong><em>*ROW CONSTRAINTS</em>*</strong> 
Make a copy of the array to mutate.</p>             </td>             <td class="code">               <div class="highlight"><pre>						<span class="nx">temp</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">internalRepr</span><span class="p">[</span><span class="nx">row</span><span class="p">].</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>Check if it's identical to any other pairs in the row after removing it from the array.</p>             </td>             <td class="code">               <div class="highlight"><pre>						<span class="nx">removed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
						<span class="nx">temp</span> <span class="o">=</span> <span class="nx">temp</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">array</span><span class="p">){</span>
							<span class="k">if</span><span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">compareArrays</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">removed</span><span class="p">){</span>
								<span class="nx">removed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
								<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
							<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
								
								<span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
							<span class="p">}</span>
						<span class="p">});</span>
						</pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>Does enough of these exist in the row?</p>             </td>             <td class="code">               <div class="highlight"><pre>						<span class="nx">other</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
						<span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">temp</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">val</span><span class="p">){</span>
							<span class="k">if</span><span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">compareArrays</span><span class="p">(</span><span class="nx">val</span><span class="p">)){</span>
								<span class="nx">numMatches</span><span class="o">++</span><span class="p">;</span>
							<span class="p">}</span>
						<span class="p">});</span>
						<span class="k">if</span><span class="p">(</span><span class="nx">numMatches</span> <span class="o">===</span> <span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">){</span>
							<span class="nx">numMatches</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>Remove every instance of the pair from all its supersets in the row.</p>             </td>             <td class="code">               <div class="highlight"><pre>							<span class="k">this</span><span class="p">.</span><span class="nx">internalRepr</span><span class="p">[</span><span class="nx">row</span><span class="p">]</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">internalRepr</span><span class="p">[</span><span class="nx">row</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">index</span><span class="p">){</span>
								<span class="k">if</span><span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">compareArrays</span><span class="p">(</span><span class="nx">element</span><span class="p">)){</span>
									<span class="k">return</span> <span class="p">[</span><span class="nx">element</span><span class="p">];</span>
								<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
									<span class="kd">var</span> <span class="nx">t</span><span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">a</span><span class="p">){</span>
										<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
										<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
											<span class="k">if</span><span class="p">(</span><span class="nx">elem</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="nx">e</span><span class="p">){</span>
												<span class="nx">Sudoku</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Eliminated &#39;</span> <span class="o">+</span> <span class="nx">e</span> <span class="o">+</span> <span class="s1">&#39; from &#39;</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="nx">row</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nx">index</span> <span class="o">+</span> <span class="s1">&#39;)s possibility list in the knowledge base.&#39;</span><span class="p">);</span>
												<span class="nx">result</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
												<span class="k">break</span><span class="p">;</span>
											<span class="p">}</span>
										<span class="p">}</span>
										<span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
									<span class="p">});</span>
									<span class="k">return</span> <span class="p">[</span><span class="nx">t</span><span class="p">];</span>
								<span class="p">}</span>
							<span class="p">});</span>
						<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p><strong><em>*COLUMN CONSTRAINTS</em>*</strong> </p>             </td>             <td class="code">               <div class="highlight"><pre>						<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
							<span class="k">if</span><span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">compareArrays</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">internalRepr</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">col</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">i</span> <span class="o">!==</span> <span class="nx">row</span><span class="p">){</span>
								<span class="nx">numMatches</span><span class="o">++</span><span class="p">;</span>
							<span class="p">}</span>
						<span class="p">}</span>

						<span class="k">if</span><span class="p">(</span><span class="nx">numMatches</span> <span class="o">===</span> <span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">){</span>
							<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
								<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">elem</span><span class="p">.</span><span class="nx">compareArrays</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">internalRepr</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">col</span><span class="p">])){</span>
									<span class="k">this</span><span class="p">.</span><span class="nx">internalRepr</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">col</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">internalRepr</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">col</span><span class="p">].</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">arr</span><span class="p">){</span>
										<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
										<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
											<span class="k">if</span><span class="p">(</span><span class="nx">elem</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="nx">e</span><span class="p">){</span>
												<span class="nx">Sudoku</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Eliminated &#39;</span> <span class="o">+</span> <span class="nx">e</span> <span class="o">+</span> <span class="s1">&#39; from &#39;</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="nx">col</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nx">index</span> <span class="o">+</span> <span class="s1">&#39;)s possibility list in the knowledge base.&#39;</span><span class="p">);</span>
												<span class="nx">result</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
												<span class="k">break</span><span class="p">;</span>
											<span class="p">}</span>
										<span class="p">}</span>
										<span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
									<span class="p">});</span>
								<span class="p">}</span>
							<span class="p">}</span>
						<span class="p">}</span>
					<span class="p">}</span>
				<span class="p">}</span> 
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">};</span>

    <span class="nx">Sudoku</span><span class="p">.</span><span class="nx">Solver</span> <span class="o">=</span> <span class="nx">Solver</span><span class="p">;</span>
<span class="p">})();</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 